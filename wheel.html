<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fortune Wheel // Redlix Corp</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Retro-Futuristic Palette */
            --rlx-red: #C23A2B;
            --rlx-ember: #D4793A;
            --rlx-cream: #E8DCC4;
            --rlx-charcoal: #1A1918;
            --rlx-brown: #3D3229;
            --rlx-teal: #2D6B6B;
            --rlx-gold: #B8954F;
            --rlx-paper: #F4EDE1;
            --rlx-ink: #2C2824;
            
            --font-head: "Space Grotesk", system-ui, sans-serif;
            --font-body: "Inter", system-ui, sans-serif;
            
            --radius: 4px;
            --border-width: 2px;
            
            --noise: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%' height='100%' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
        }
        
        * { box-sizing: border-box; }
        
        body {
            margin: 0;
            font-family: var(--font-body);
            background: var(--rlx-cream);
            background-image: var(--noise);
            color: var(--rlx-ink);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }
        
        .fortune-wheel-app {
            max-width: 1100px;
            margin: 0 auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        /* Header: Classified Document Style */
        .app-header {
            background: var(--rlx-brown);
            color: var(--rlx-cream);
            padding: 0;
            border: var(--border-width) solid var(--rlx-charcoal);
            position: relative;
            overflow: hidden;
        }
        
        .app-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 8px;
            background: repeating-linear-gradient(
                90deg,
                var(--rlx-red) 0px,
                var(--rlx-red) 30px,
                var(--rlx-charcoal) 30px,
                var(--rlx-charcoal) 32px
            );
        }
        
        .app-header::after {
            content: '';
            position: absolute;
            bottom: 0; left: 0; right: 0;
            height: 8px;
            background: repeating-linear-gradient(
                90deg,
                var(--rlx-red) 0px,
                var(--rlx-red) 30px,
                var(--rlx-charcoal) 30px,
                var(--rlx-charcoal) 32px
            );
        }
        
        .header-inner {
            padding: 2.5rem 2rem;
            position: relative;
        }
        
        .stamp {
            position: absolute;
            top: 1.5rem;
            right: 2rem;
            width: 80px;
            height: 80px;
            border: 3px solid var(--rlx-red);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: rotate(12deg);
            opacity: 0.85;
        }
        
        .stamp-inner {
            width: 62px;
            height: 62px;
            border: 2px solid var(--rlx-red);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-head);
            font-size: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            text-align: center;
            line-height: 1.3;
            color: var(--rlx-red);
        }
        
        .hero-meta {
            font-family: var(--font-head);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            opacity: 0.7;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .hero-meta::before,
        .hero-meta::after {
            content: 'â—†';
            font-size: 0.5rem;
        }
        
        .hero-title {
            font-family: var(--font-head);
            font-size: clamp(2rem, 5vw, 3.5rem);
            text-transform: uppercase;
            line-height: 0.95;
            margin: 0 0 1rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            max-width: 70%;
        }
        
        .hero-desc {
            max-width: 45ch;
            font-size: 0.95rem;
            opacity: 0.8;
            border-left: 3px solid var(--rlx-gold);
            padding-left: 1rem;
            margin: 0;
        }
        
        /* Section styling */
        .section {
            background: var(--rlx-paper);
            padding: 0;
            border: var(--border-width) solid var(--rlx-charcoal);
            position: relative;
        }
        
        .section-header {
            background: var(--rlx-charcoal);
            color: var(--rlx-cream);
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .section-header h2 {
            font-family: var(--font-head);
            text-transform: uppercase;
            font-size: 0.9rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            letter-spacing: 0.1em;
        }
        
        .section-num {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--rlx-gold);
            line-height: 1;
        }
        
        .section-code {
            font-size: 0.65rem;
            opacity: 0.6;
            letter-spacing: 0.15em;
            font-family: var(--font-head);
        }
        
        .section-content {
            padding: 1.5rem;
        }
        
        /* Wheel Section */
        .wheel-section .section-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }
        
        .wheel-wrapper {
            position: relative;
            width: 320px;
            height: 320px;
            margin-bottom: 1.5rem;
        }
        
        #wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 4px solid var(--rlx-charcoal);
            position: relative;
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            box-shadow: 
                0 0 0 6px var(--rlx-brown),
                0 8px 20px rgba(0,0,0,0.25);
        }
        
        .arrow {
            position: absolute;
            top: -22px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 14px solid transparent;
            border-right: 14px solid transparent;
            border-top: 28px solid var(--rlx-red);
            z-index: 10;
            filter: drop-shadow(0 3px 4px rgba(0,0,0,0.3));
        }
        
        .arrow::after {
            content: '';
            position: absolute;
            top: -28px;
            left: -10px;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 20px solid var(--rlx-ember);
        }
        
        /* Buttons */
        button {
            font-family: var(--font-head);
            font-weight: 700;
            font-size: 0.8rem;
            border: var(--border-width) solid var(--rlx-charcoal);
            padding: 0.9rem 1.8rem;
            text-transform: uppercase;
            cursor: pointer;
            letter-spacing: 0.1em;
            transition: all 0.15s ease;
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, rgba(255,255,255,0.1) 0%, transparent 50%);
        }
        
        button:hover {
            transform: translateY(-1px);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .btn-primary {
            background: var(--rlx-red);
            color: var(--rlx-cream);
            box-shadow: 0 4px 0 #8B2820;
        }
        .btn-primary:hover { box-shadow: 0 5px 0 #8B2820; }
        .btn-primary:active { box-shadow: 0 2px 0 #8B2820; }
        
        .btn-secondary {
            background: var(--rlx-teal);
            color: var(--rlx-cream);
            box-shadow: 0 4px 0 #1E4A4A;
        }
        .btn-secondary:hover { box-shadow: 0 5px 0 #1E4A4A; }
        .btn-secondary:active { box-shadow: 0 2px 0 #1E4A4A; }
        
        .btn-ghost {
            background: var(--rlx-paper);
            color: var(--rlx-charcoal);
            box-shadow: 0 4px 0 var(--rlx-brown);
        }
        .btn-ghost:hover { box-shadow: 0 5px 0 var(--rlx-brown); }
        .btn-ghost:active { box-shadow: 0 2px 0 var(--rlx-brown); }
        
        .btn-danger {
            background: var(--rlx-brown);
            color: var(--rlx-cream);
            box-shadow: 0 4px 0 var(--rlx-charcoal);
        }
        .btn-danger:hover { box-shadow: 0 5px 0 var(--rlx-charcoal); }
        .btn-danger:active { box-shadow: 0 2px 0 var(--rlx-charcoal); }
        
        #spinBtn {
            padding: 1rem 3rem;
            font-size: 0.9rem;
        }
        
        #spinBtn:disabled {
            background: #6B6B6B;
            box-shadow: 0 4px 0 #4A4A4A;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Grid System */
        .grid {
            display: grid;
            gap: 2rem;
        }
        
        @media (min-width: 700px) {
            .grid-2 { grid-template-columns: 1fr 1fr; }
        }
        
        /* Controls */
        .control-label {
            display: block;
            margin-bottom: 0.5rem;
            font-family: var(--font-head);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--rlx-brown);
        }
        
        select, input[type="text"], input[type="number"] {
            width: 100%;
            padding: 0.75rem;
            background: var(--rlx-cream);
            border: var(--border-width) solid var(--rlx-charcoal);
            color: var(--rlx-ink);
            font-size: 0.85rem;
            font-family: var(--font-body);
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        
        select:hover, input[type="text"]:hover, input[type="number"]:hover {
            border-color: var(--rlx-brown);
        }
        
        select:focus, input[type="text"]:focus, input[type="number"]:focus {
            outline: none;
            border-color: var(--rlx-teal);
            box-shadow: 0 0 0 3px rgba(45, 107, 107, 0.2);
        }
        
        input[type="color"] {
            width: 50px;
            height: 42px;
            border: var(--border-width) solid var(--rlx-charcoal);
            background: var(--rlx-cream);
            cursor: pointer;
            padding: 2px;
        }
        
        input[type="color"]:hover {
            border-color: var(--rlx-teal);
        }
        
        /* Palette Preview */
        .palette-preview {
            display: flex;
            gap: 2px;
            margin-top: 1rem;
        }
        
        .palette-color {
            flex: 1;
            height: 36px;
            border: 2px solid var(--rlx-charcoal);
            transition: transform 0.2s;
            cursor: pointer;
        }
        
        .palette-color:hover {
            transform: scale(1.05);
            z-index: 1;
        }
        
        /* Fields List */
        #fieldsList {
            max-height: 280px;
            overflow-y: auto;
            margin-bottom: 1rem;
            border: 1px solid var(--rlx-brown);
            background: var(--rlx-cream);
            padding: 0.75rem;
        }
        
        #fieldsList::-webkit-scrollbar {
            width: 8px;
        }
        
        #fieldsList::-webkit-scrollbar-track {
            background: var(--rlx-cream);
            border-left: 1px solid var(--rlx-brown);
        }
        
        #fieldsList::-webkit-scrollbar-thumb {
            background: var(--rlx-teal);
            border: 1px solid var(--rlx-charcoal);
        }
        
        #fieldsList::-webkit-scrollbar-thumb:hover {
            background: var(--rlx-red);
        }
        
        .field-item {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px dashed var(--rlx-brown);
            align-items: center;
        }
        
        .field-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .field-item input[type="text"] {
            flex: 2;
            padding: 0.6rem;
        }
        
        .field-item input[type="number"] {
            width: 70px;
            padding: 0.6rem 0.4rem;
            text-align: center;
        }
        
        .field-item input[type="color"] {
            width: 42px;
            height: 38px;
        }
        
        .field-item button {
            padding: 0.5rem 0.75rem;
            font-size: 0.7rem;
        }
        
        /* Button Group */
        .btn-group {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        
        .btn-group button {
            flex: 1;
            min-width: 100px;
        }
        
        /* Divider */
        .divider {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1.25rem 0;
            color: var(--rlx-brown);
        }
        
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: repeating-linear-gradient(
                90deg,
                var(--rlx-brown) 0px,
                var(--rlx-brown) 4px,
                transparent 4px,
                transparent 8px
            );
        }
        
        .divider span {
            font-family: var(--font-head);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
        }
        
        /* Import/Export Section */
        .import-export-buttons {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        
        .import-export-buttons button {
            flex: 1;
            min-width: 180px;
        }
        
        #fileInput {
            display: none;
        }
        
        /* Status Message */
        .status-message {
            margin-top: 1rem;
            padding: 0.75rem 1rem;
            font-family: var(--font-head);
            font-weight: 700;
            border: var(--border-width) solid var(--rlx-charcoal);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-size: 0.8rem;
            display: none;
            position: relative;
        }
        
        .status-message::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
        }
        
        .status-message.success {
            background: var(--rlx-cream);
            color: var(--rlx-teal);
            display: block;
        }
        
        .status-message.success::before {
            background: var(--rlx-teal);
        }
        
        .status-message.error {
            background: var(--rlx-cream);
            color: var(--rlx-red);
            display: block;
        }
        
        .status-message.error::before {
            background: var(--rlx-red);
        }
        
        /* Footer */
        .app-footer {
            text-align: center;
            font-family: var(--font-head);
            font-size: 0.7rem;
            color: var(--rlx-brown);
            padding: 1.5rem 0;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            border-top: 1px solid var(--rlx-brown);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }
        
        .app-footer::before {
            content: 'â—† â—† â—†';
            letter-spacing: 0.5em;
            opacity: 0.5;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .fortune-wheel-app {
                padding: 1rem;
                gap: 1.5rem;
            }
            
            .header-inner {
                padding: 2rem 1.5rem;
            }
            
            .hero-title {
                max-width: 85%;
            }
            
            .stamp {
                width: 60px;
                height: 60px;
                top: 1rem;
                right: 1rem;
            }
            
            .stamp-inner {
                width: 48px;
                height: 48px;
                font-size: 0.4rem;
            }
            
            .wheel-wrapper {
                width: 260px;
                height: 260px;
            }
            
            .section-content {
                padding: 1rem;
            }
            
            .grid {
                gap: 1.5rem;
            }
            
            .field-item {
                flex-wrap: wrap;
            }
            
            .field-item input[type="text"] {
                flex: 1 1 100%;
                margin-bottom: 0.5rem;
            }
            
            .import-export-buttons {
                flex-direction: column;
            }
            
            .import-export-buttons button {
                min-width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .fortune-wheel-app {
                padding: 0.75rem;
            }
            
            .header-inner {
                padding: 1.5rem 1rem;
            }
            
            .hero-meta {
                font-size: 0.6rem;
            }
            
            .hero-title {
                font-size: 1.8rem;
            }
            
            .hero-desc {
                font-size: 0.85rem;
            }
            
            .wheel-wrapper {
                width: 220px;
                height: 220px;
            }
            
            #spinBtn {
                padding: 0.75rem 2rem;
                font-size: 0.8rem;
            }
            
            .section-header h2 {
                font-size: 0.75rem;
            }
            
            .section-num {
                font-size: 1.2rem;
            }
            
            .btn-group button {
                min-width: auto;
                padding: 0.6rem 1rem;
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <div class="fortune-wheel-app">
        <header class="app-header">
            <div class="header-inner">
                <div class="stamp">
                    <div class="stamp-inner">Game<br>Module<br>v1.0</div>
                </div>
                <span class="hero-meta">Module Ref: FW-2024-G1</span>
                <h1 class="hero-title">Fortune<br>Wheel</h1>
                <p class="hero-desc">Probability-based selection interface. Spin the wheel to determine outcomes. All results are final and binding.</p>
            </div>
        </header>
        
        <section class="section wheel-section">
            <div class="section-header">
                <h2><span class="section-num">01</span> Spin Interface</h2>
                <span class="section-code">SPIN-MOD-A1</span>
            </div>
            <div class="section-content">
                <div class="wheel-wrapper">
                    <div class="arrow"></div>
                    <canvas id="wheel" width="400" height="400"></canvas>
                </div>
                <button id="spinBtn" class="btn-primary">â–¶ Initiate Spin</button>
            </div>
        </section>
        
        <div class="grid grid-2">
            <section class="section">
                <div class="section-header">
                    <h2><span class="section-num">02</span> Color Palette</h2>
                    <span class="section-code">COL-CFG-B2</span>
                </div>
                <div class="section-content">
                    <label class="control-label" for="paletteSelect">Select Palette</label>
                    <select id="paletteSelect"></select>
                    <div class="palette-preview" id="palettePreview"></div>
                </div>
            </section>
            
            <section class="section">
                <div class="section-header">
                    <h2><span class="section-num">03</span> Wheel Fields</h2>
                    <span class="section-code">FLD-CFG-C3</span>
                </div>
                <div class="section-content">
                    <div id="fieldsList"></div>
                    <div class="btn-group">
                        <button id="addFieldBtn" class="btn-secondary">+ Add Field</button>
                        <button id="clearFieldsBtn" class="btn-danger">Clear All</button>
                    </div>
                </div>
            </section>
        </div>
        
        <section class="section">
            <div class="section-header">
                <h2><span class="section-num">04</span> Data Management</h2>
                <span class="section-code">DAT-MGT-D4</span>
            </div>
            <div class="section-content">
                <p style="margin: 0 0 1rem; font-size: 0.85rem; color: var(--rlx-brown);">Export current configuration or import a previously saved setup. All data is stored in JSON format.</p>
                <div class="import-export-buttons">
                    <button id="exportBtn" class="btn-secondary">ðŸ“¥ Export Configuration</button>
                    <button id="importBtn" class="btn-ghost">ðŸ“¤ Import Configuration</button>
                    <input type="file" id="fileInput" accept=".json" />
                </div>
                <div id="statusMessage" class="status-message"></div>
            </div>
        </section>
        
        <footer class="app-footer">
            <span>Redlix Corporation // Game Systems Division // 2024</span>
            <span style="opacity: 0.6; font-size: 0.6rem;">Fortune Wheel Module â€” Authorized for recreational use only.</span>
        </footer>
    </div>

    <script>
        (function() {
            'use strict';
            
            function initFortuneWheel() {
                // Modern color palettes matching Redlix design
                const colorPalettes = {
                    'Redlix Standard': ['#C23A2B', '#D4793A', '#B8954F', '#2D6B6B', '#3D3229'],
                    'Propaganda': ['#C23A2B', '#8B2820', '#D4793A', '#B8954F', '#1A1918'],
                    'Terminal': ['#2D6B6B', '#1E4A4A', '#3D8B8B', '#5AABAB', '#1A1918'],
                    'Document': ['#3D3229', '#5A4A3D', '#B8954F', '#D4793A', '#C23A2B'],
                    'Sunset Vibes': ['#FF6B6B', '#FF8E53', '#FFA07A', '#FFB84D', '#FFC947'],
                    'Ocean Breeze': ['#0A4D68', '#088395', '#05BFDB', '#00FFCA', '#7DFFEA'],
                    'Forest Fresh': ['#1B4D3E', '#2D8B5F', '#3FA876', '#6FC77B', '#A8E6A1'],
                    'Neon Nights': ['#FF006E', '#FB5607', '#FFBE0B', '#8338EC', '#3A86FF'],
                    'Berry Blast': ['#D62828', '#F77F00', '#FCBF49', '#EAE2B7', '#C9ADA7'],
                    'Cool Mint': ['#52B788', '#74C69D', '#95D5B2', '#B7E4C7', '#D8F3DC']
                };
                
                let currentPalette = 'Redlix Standard';
                let fields = [
                    { text: 'Prize 1', color: '#C23A2B', percentage: null },
                    { text: 'Prize 2', color: '#2D6B6B', percentage: null },
                    { text: 'Prize 3', color: '#D4793A', percentage: null },
                    { text: 'Prize 4', color: '#B8954F', percentage: null }
                ];
                
                let isSpinning = false;
                let currentRotation = 0;
                
                // Audio context and sound generation
                let audioContext = null;
                let spinningGainNode = null;
                let melodyInterval = null;
                let currentTempo = 1.0;
                let spinStartTime = 0;
                let spinDuration = 0;
                
                function initAudioContext() {
                    if (!audioContext) {
                        audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    }
                    return audioContext;
                }
                
                function playClickSound() {
                    const ctx = initAudioContext();
                    const frequencies = [200, 400, 600];
                    frequencies.forEach((freq, index) => {
                        const oscillator = ctx.createOscillator();
                        const gainNode = ctx.createGain();
                        oscillator.connect(gainNode);
                        gainNode.connect(ctx.destination);
                        oscillator.frequency.value = freq;
                        oscillator.type = 'sine';
                        const startTime = ctx.currentTime + (index * 0.01);
                        gainNode.gain.setValueAtTime(0.1, startTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.08);
                        oscillator.start(startTime);
                        oscillator.stop(startTime + 0.08);
                    });
                }
                
                function startSpinningSound(duration) {
                    const ctx = initAudioContext();
                    spinStartTime = ctx.currentTime;
                    spinDuration = duration;
                    spinningGainNode = ctx.createGain();
                    spinningGainNode.connect(ctx.destination);
                    spinningGainNode.gain.setValueAtTime(0, ctx.currentTime);
                    spinningGainNode.gain.linearRampToValueAtTime(0.15, ctx.currentTime + 0.3);
                    
                    const melodyNotes = [523.25, 659.25, 783.99, 1046.5];
                    let noteIndex = 0;
                    
                    function playNote() {
                        if (!spinningGainNode) return;
                        const ctx = audioContext;
                        const elapsed = ctx.currentTime - spinStartTime;
                        const progress = Math.min(elapsed / spinDuration, 1);
                        const tempoProgress = 1 - Math.pow(progress, 2.5);
                        currentTempo = 0.3 + (tempoProgress * 1.7);
                        const baseNoteDuration = 0.15;
                        const noteDuration = baseNoteDuration / currentTempo;
                        
                        const oscillator = ctx.createOscillator();
                        const noteGain = ctx.createGain();
                        const filter = ctx.createBiquadFilter();
                        oscillator.connect(filter);
                        filter.connect(noteGain);
                        noteGain.connect(spinningGainNode);
                        oscillator.type = 'triangle';
                        oscillator.frequency.value = melodyNotes[noteIndex];
                        filter.type = 'lowpass';
                        filter.frequency.value = 2000;
                        filter.Q.value = 1;
                        
                        const now = ctx.currentTime;
                        noteGain.gain.setValueAtTime(0, now);
                        noteGain.gain.linearRampToValueAtTime(0.8, now + 0.01);
                        noteGain.gain.linearRampToValueAtTime(0, now + noteDuration);
                        oscillator.start(now);
                        oscillator.stop(now + noteDuration);
                        noteIndex = (noteIndex + 1) % melodyNotes.length;
                        
                        if (progress < 1) {
                            const nextInterval = noteDuration * 1000;
                            melodyInterval = setTimeout(playNote, nextInterval);
                        }
                    }
                    playNote();
                }
                
                function stopSpinningSound() {
                    if (spinningGainNode && audioContext) {
                        const ctx = audioContext;
                        const fadeOutTime = 0.5;
                        spinningGainNode.gain.linearRampToValueAtTime(0.01, ctx.currentTime + fadeOutTime);
                        if (melodyInterval) {
                            clearTimeout(melodyInterval);
                            melodyInterval = null;
                        }
                        setTimeout(() => { spinningGainNode = null; }, fadeOutTime * 1000 + 100);
                    }
                }
                
                function playStopSound() {
                    const ctx = initAudioContext();
                    const frequencies = [523.25, 659.25, 783.99];
                    frequencies.forEach((freq, index) => {
                        const oscillator = ctx.createOscillator();
                        const gainNode = ctx.createGain();
                        const filter = ctx.createBiquadFilter();
                        oscillator.connect(filter);
                        filter.connect(gainNode);
                        gainNode.connect(ctx.destination);
                        oscillator.type = 'sine';
                        oscillator.frequency.value = freq;
                        filter.type = 'lowpass';
                        filter.frequency.value = 2000;
                        const startTime = ctx.currentTime + (index * 0.05);
                        gainNode.gain.setValueAtTime(0.15, startTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.001, startTime + 0.8);
                        oscillator.start(startTime);
                        oscillator.stop(startTime + 0.8);
                    });
                    
                    const bellOsc = ctx.createOscillator();
                    const bellGain = ctx.createGain();
                    bellOsc.connect(bellGain);
                    bellGain.connect(ctx.destination);
                    bellOsc.type = 'sine';
                    bellOsc.frequency.value = 1046.5;
                    bellGain.gain.setValueAtTime(0.08, ctx.currentTime + 0.1);
                    bellGain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.6);
                    bellOsc.start(ctx.currentTime + 0.1);
                    bellOsc.stop(ctx.currentTime + 0.6);
                }
                
                function renderPaletteSelector() {
                    const select = document.getElementById('paletteSelect');
                    select.innerHTML = '';
                    Object.keys(colorPalettes).forEach(paletteName => {
                        const option = document.createElement('option');
                        option.value = paletteName;
                        option.textContent = paletteName;
                        if (paletteName === currentPalette) option.selected = true;
                        select.appendChild(option);
                    });
                    select.addEventListener('change', (e) => {
                        currentPalette = e.target.value;
                        applyPalette(currentPalette);
                        updatePalettePreview();
                    });
                    updatePalettePreview();
                }
                
                function updatePalettePreview() {
                    const preview = document.getElementById('palettePreview');
                    preview.innerHTML = '';
                    const colors = colorPalettes[currentPalette];
                    colors.forEach(color => {
                        const colorBox = document.createElement('div');
                        colorBox.className = 'palette-color';
                        colorBox.style.backgroundColor = color;
                        colorBox.title = color;
                        preview.appendChild(colorBox);
                    });
                }
                
                function applyPalette(paletteName) {
                    const colors = colorPalettes[paletteName];
                    fields.forEach((field, index) => {
                        field.color = colors[index % colors.length];
                    });
                    renderFields();
                    drawWheel();
                }
                
                function getNextColorForPalette() {
                    const colors = colorPalettes[currentPalette];
                    return colors[fields.length % colors.length];
                }
                
                function calculatePercentages() {
                    const customFields = fields.filter(f => f.percentage !== null);
                    const autoFields = fields.filter(f => f.percentage === null);
                    let customTotal = customFields.reduce((sum, f) => sum + f.percentage, 0);
                    if (customTotal > 100) {
                        customTotal = 100;
                        customFields.forEach(f => f.percentage = (f.percentage / customTotal) * 100);
                        customTotal = 100;
                    }
                    const remaining = 100 - customTotal;
                    const autoPercentage = autoFields.length > 0 ? remaining / autoFields.length : 0;
                    return fields.map(f => ({
                        ...f,
                        actualPercentage: f.percentage !== null ? f.percentage : autoPercentage
                    }));
                }
                
                function drawWheel() {
                    const canvas = document.getElementById('wheel');
                    const ctx = canvas.getContext('2d');
                    const centerX = canvas.width / 2;
                    const centerY = canvas.height / 2;
                    const radius = canvas.width / 2 - 10;
                    
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    const fieldsWithPercentages = calculatePercentages();
                    let startAngle = 0;
                    
                    fieldsWithPercentages.forEach((field, index) => {
                        const sliceAngle = (field.actualPercentage / 100) * 2 * Math.PI;
                        ctx.beginPath();
                        ctx.fillStyle = field.color;
                        ctx.moveTo(centerX, centerY);
                        ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
                        ctx.lineTo(centerX, centerY);
                        ctx.fill();
                        ctx.strokeStyle = '#1A1918';
                        ctx.lineWidth = 2;
                        ctx.stroke();
                        
                        ctx.save();
                        ctx.translate(centerX, centerY);
                        ctx.rotate(startAngle + sliceAngle / 2);
                        ctx.textAlign = 'center';
                        ctx.fillStyle = '#F4EDE1';
                        ctx.font = 'bold 14px "Space Grotesk", sans-serif';
                        ctx.shadowColor = 'rgba(0,0,0,0.5)';
                        ctx.shadowBlur = 3;
                        ctx.shadowOffsetX = 1;
                        ctx.shadowOffsetY = 1;
                        ctx.fillText(field.text, radius / 2, 5);
                        ctx.restore();
                        startAngle += sliceAngle;
                    });
                    
                    // Center circle
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, 20, 0, 2 * Math.PI);
                    ctx.fillStyle = '#1A1918';
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, 12, 0, 2 * Math.PI);
                    ctx.fillStyle = '#B8954F';
                    ctx.fill();
                }
                
                function renderFields() {
                    const fieldsList = document.getElementById('fieldsList');
                    fieldsList.innerHTML = '';
                    
                    fields.forEach((field, index) => {
                        const fieldItem = document.createElement('div');
                        fieldItem.className = 'field-item';
                        
                        const textInput = document.createElement('input');
                        textInput.type = 'text';
                        textInput.value = field.text;
                        textInput.placeholder = 'Field text';
                        textInput.addEventListener('input', (e) => {
                            fields[index].text = e.target.value;
                            drawWheel();
                        });
                        
                        const colorInput = document.createElement('input');
                        colorInput.type = 'color';
                        colorInput.value = field.color;
                        colorInput.addEventListener('input', (e) => {
                            fields[index].color = e.target.value;
                            drawWheel();
                        });
                        
                        const percentInput = document.createElement('input');
                        percentInput.type = 'number';
                        percentInput.min = '0';
                        percentInput.max = '100';
                        percentInput.placeholder = '%';
                        percentInput.value = field.percentage !== null ? field.percentage : '';
                        percentInput.addEventListener('input', (e) => {
                            fields[index].percentage = e.target.value ? parseFloat(e.target.value) : null;
                            drawWheel();
                        });
                        
                        const removeBtn = document.createElement('button');
                        removeBtn.className = 'btn-ghost';
                        removeBtn.textContent = 'âœ•';
                        removeBtn.addEventListener('click', () => {
                            if (fields.length > 2) {
                                fields.splice(index, 1);
                                renderFields();
                                drawWheel();
                            } else {
                                showStatus('Minimum 2 fields required', 'error');
                            }
                        });
                        
                        fieldItem.appendChild(textInput);
                        fieldItem.appendChild(colorInput);
                        fieldItem.appendChild(percentInput);
                        fieldItem.appendChild(removeBtn);
                        fieldsList.appendChild(fieldItem);
                    });
                }
                
                document.getElementById('addFieldBtn').addEventListener('click', () => {
                    const newColor = getNextColorForPalette();
                    fields.push({
                        text: `Prize ${fields.length + 1}`,
                        color: newColor,
                        percentage: null
                    });
                    renderFields();
                    drawWheel();
                });
                
                document.getElementById('clearFieldsBtn').addEventListener('click', () => {
                    if (confirm('Clear all fields and reset to defaults?')) {
                        const colors = colorPalettes[currentPalette];
                        fields = [
                            { text: 'Prize 1', color: colors[0], percentage: null },
                            { text: 'Prize 2', color: colors[1], percentage: null }
                        ];
                        renderFields();
                        drawWheel();
                        showStatus('Fields cleared successfully', 'success');
                    }
                });
                
                document.getElementById('spinBtn').addEventListener('click', () => {
                    if (isSpinning) return;
                    playClickSound();
                    isSpinning = true;
                    document.getElementById('spinBtn').disabled = true;
                    
                    const canvas = document.getElementById('wheel');
                    const fieldsWithPercentages = calculatePercentages();
                    const random = Math.random() * 100;
                    let accumulatedPercentage = 0;
                    let winner = fieldsWithPercentages[0];
                    let winnerIndex = 0;
                    
                    for (let i = 0; i < fieldsWithPercentages.length; i++) {
                        accumulatedPercentage += fieldsWithPercentages[i].actualPercentage;
                        if (random <= accumulatedPercentage) {
                            winner = fieldsWithPercentages[i];
                            winnerIndex = i;
                            break;
                        }
                    }
                    
                    let winnerStartAngle = 0;
                    for (let i = 0; i < winnerIndex; i++) {
                        winnerStartAngle += (fieldsWithPercentages[i].actualPercentage / 100) * 360;
                    }
                    const winnerSliceAngle = (winner.actualPercentage / 100) * 360;
                    const randomOffsetInSegment = (Math.random() - 0.5) * winnerSliceAngle * 0.9;
                    const winnerCenterAngle = winnerStartAngle + (winnerSliceAngle / 2) + randomOffsetInSegment;
                    const targetAngle = 360 - winnerCenterAngle;
                    const spins = 3 + Math.floor(Math.random() * 13);
                    const totalRotation = Math.abs(spins * 360 + targetAngle);
                    
                    canvas.style.transition = 'none';
                    canvas.style.transform = 'rotate(0deg)';
                    currentRotation = 0;
                    canvas.offsetHeight;
                    
                    const duration = 2.5 + Math.random() * 3.5;
                    const easingCurves = [
                        'cubic-bezier(0.17, 0.67, 0.12, 0.99)',
                        'cubic-bezier(0.25, 0.46, 0.45, 0.94)',
                        'cubic-bezier(0.33, 0.64, 0.20, 1.00)',
                        'cubic-bezier(0.22, 0.61, 0.36, 1.00)'
                    ];
                    const randomEasing = easingCurves[Math.floor(Math.random() * easingCurves.length)];
                    
                    canvas.style.transition = `transform ${duration}s ${randomEasing}`;
                    canvas.style.transform = `rotate(${totalRotation}deg)`;
                    currentRotation = totalRotation;
                    
                    startSpinningSound(duration);
                    
                    setTimeout(() => {
                        stopSpinningSound();
                        setTimeout(() => { playStopSound(); }, 100);
                        isSpinning = false;
                        document.getElementById('spinBtn').disabled = false;
                    }, duration * 1000);
                });
                
                function exportConfig() {
                    const config = {
                        version: '1.0',
                        palette: currentPalette,
                        fields: fields.map(f => ({
                            text: f.text,
                            color: f.color,
                            percentage: f.percentage
                        })),
                        timestamp: new Date().toISOString()
                    };
                    
                    const dataStr = JSON.stringify(config, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `wheel-config-${Date.now()}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    showStatus('Configuration exported successfully', 'success');
                }
                
                function importConfig(file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const config = JSON.parse(e.target.result);
                            if (!config.fields || !Array.isArray(config.fields)) {
                                throw new Error('Invalid configuration: missing fields array');
                            }
                            if (config.fields.length < 2) {
                                throw new Error('Configuration must have at least 2 fields');
                            }
                            fields = config.fields.map(f => ({
                                text: f.text || 'Prize',
                                color: f.color || '#C23A2B',
                                percentage: f.percentage !== undefined ? f.percentage : null
                            }));
                            if (config.palette && colorPalettes[config.palette]) {
                                currentPalette = config.palette;
                                document.getElementById('paletteSelect').value = currentPalette;
                                updatePalettePreview();
                            }
                            renderFields();
                            drawWheel();
                            showStatus('Configuration imported successfully', 'success');
                        } catch (error) {
                            showStatus(`Import error: ${error.message}`, 'error');
                            console.error('Import error:', error);
                        }
                    };
                    reader.onerror = function() {
                        showStatus('Error reading file', 'error');
                    };
                    reader.readAsText(file);
                }
                
                function showStatus(message, type) {
                    const statusEl = document.getElementById('statusMessage');
                    statusEl.textContent = message;
                    statusEl.className = `status-message ${type}`;
                    setTimeout(() => { statusEl.className = 'status-message'; }, 5000);
                }
                
                document.getElementById('exportBtn').addEventListener('click', exportConfig);
                document.getElementById('importBtn').addEventListener('click', () => {
                    document.getElementById('fileInput').click();
                });
                document.getElementById('fileInput').addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) importConfig(file);
                    e.target.value = '';
                });
                
                // Initialize
                renderPaletteSelector();
                renderFields();
                drawWheel();
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initFortuneWheel);
            } else {
                initFortuneWheel();
            }
        })();
    </script>
</body>
</html>